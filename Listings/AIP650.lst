C51 COMPILER V9.60.0.0   AIP650                                                            04/03/2021 12:04:58 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE AIP650
OBJECT MODULE PLACED IN .\Objects\AIP650.obj
COMPILER INVOKED BY: D:\Keil\C51\c51v960a\C51\BIN\C51.EXE HARDWARE\AIP650\AIP650.c OPTIMIZE(8,SPEED) BROWSE INCDIR(.\MAI
                    -N;.\delay;.\HARDWARE\AIP650;.\HARDWARE\GUI;.\HARDWARE\PWM;.\HARDWARE\EEPROM;.\HARDWARE\ADC;.\HARDWARE\UART;.\HARDWARE\IR
                    -) DEBUG OBJECTEXTEND PRINT(.\Listings\AIP650.lst) TABS(2) OBJECT(.\Objects\AIP650.obj)

line level    source

   1          #include "STC8G.H"
   2          #include "main.h"
   3          #include "AIP650.h"
   4          #include "delay.h"
   5          //#include  "uart.h"
   6          #include <stdio.h>
   7          #include "EEPROM.h"
   8          #include "GUI.h"
   9          
  10          u8 data Bri_bit; //数码管亮度调节
  11          
  12          extern u8 menu;      //菜单
  13          extern u8 menu_flag; //菜单标志
  14          extern u8 PA_flag;   //密码位数标志
  15          extern u8 freq_flag; //频率/声音显示标志
  16          
  17          //数码管0-9显示代码
  18          //--------------------------------0----1----2----3---4----5----6----7----8----9----10---11---12---13---14-
             ---15---16---17---18
  19          //                                0    1    2    3   4    5    6    7    8    9    -    A    b    c    d  
             -  e    f     h
  20          u8 DISPLAY_CODE[19] = {0x3f, 0x06, 0x5b, 0x4f, 0x66, 0x6d, 0x7d, 0x07, 0x7f, 0x6f, 0x40, 0x77, 0x7c, 0x39,
             - 0x5e, 0x79, 0x71, 0x76, 0x00};
  21          //数码管位数                      1    2    3    4
  22          u8 DIG_BIT_CODE[4] = {0x68, 0x6a, 0x6c, 0x6e};
  23          //8段显示亮度等级                 1    2    3    4    5    6    7   8
  24          u8 Light_Level_CODE[8] = {0x11, 0x21, 0x31, 0x41, 0x51, 0x61, 0x71, 0x01};
  25          
  26          //----IIC_1开始信号-----------------------------------
  27          void I2CStart(void)
  28          {
  29   1        CLK_H;
  30   1        DIO_H;
  31   1        Delay_us(5);
  32   1        DIO_L;
  33   1      }
  34          
  35          //----IIC_2开始信号-----------------------------------
  36          void I2CStart_1(void)
  37          {
  38   1        CLK1_H;
  39   1        DIO1_H;
  40   1        Delay_us(5);
  41   1        DIO1_L;
  42   1      }
  43          
  44          //----ACK_1信号-----------------------------------
  45          void I2Cask(void)
  46          {
  47   1        u8 timeout = 1;  
  48   1        CLK_H;
  49   1        Delay_us(5);
  50   1        CLK_L;
C51 COMPILER V9.60.0.0   AIP650                                                            04/03/2021 12:04:58 PAGE 2   

  51   1        while ((DIO) && (timeout <= 100))
  52   1        {
  53   2          timeout++;
  54   2        }
  55   1        Delay_us(5);
  56   1        CLK1_L;
  57   1      }
  58          
  59          //----ACK_2信号-----------------------------------
  60          void I2Cask_1(void)
  61          {
  62   1        u8 timeout = 1;
  63   1        CLK1_H;
  64   1        Delay_us(5);
  65   1        CLK1_L;
  66   1        while ((DIO1) && (timeout <= 100))
  67   1        {
  68   2          timeout++;
  69   2        }
  70   1        Delay_us(5);
  71   1        CLK1_L;
  72   1      }
  73          
  74          //----停止信号------------------------------------
  75          void I2CStop(void)
  76          {
  77   1        CLK_H;
  78   1        DIO_L;
  79   1        Delay_us(5);
  80   1        DIO_H;
  81   1      }
  82          
  83          //----停止信号------------------------------------
  84          void I2CStop_1(void)
  85          {
  86   1        CLK1_H;
  87   1        DIO1_L;
  88   1        Delay_us(5);
  89   1        DIO1_H;
  90   1      }
  91          
  92          //----写一个字节高位在前，低位在后-----------------
  93          void I2CWrByte(u8 oneByte)
  94          {
  95   1        u8 i;
  96   1        CLK_L;
  97   1        Delay_us(1);
  98   1        for (i = 0; i < 8; i++)
  99   1        {
 100   2          oneByte = oneByte << 1;
 101   2          DIO = CY;
 102   2          CLK_L;
 103   2          Delay_us(5);
 104   2          CLK_H;
 105   2          Delay_us(5);
 106   2          CLK_L;
 107   2        }
 108   1      }
 109          
 110          //----写一个字节高位在前，低位在后-----------------
 111          void I2CWrByte_1(u8 oneByte)
 112          {
C51 COMPILER V9.60.0.0   AIP650                                                            04/03/2021 12:04:58 PAGE 3   

 113   1        u8 i;
 114   1        CLK1_L;
 115   1        Delay_us(1);
 116   1        for (i = 0; i < 8; i++)
 117   1        {
 118   2          oneByte = oneByte << 1;
 119   2          DIO1 = CY;
 120   2          CLK1_L;
 121   2          Delay_us(5);
 122   2          CLK1_H;
 123   2          Delay_us(5);
 124   2          CLK1_L;
 125   2        }
 126   1      }
 127          
 128          /************************************************** 
 129            功能描述: //后4位数码管显示
 130            入口参数：
 131            说    明：                        
 132          **************************************************/
 133          void AiP650_Set(u8 add, u8 dat) //数码管显示
 134          {
 135   1        //写显存必须从高地址开始写
 136   1        I2CStart();
 137   1        I2CWrByte(add); //第一个显存地址
 138   1        I2Cask();
 139   1        I2CWrByte(dat);
 140   1        I2Cask();
 141   1        I2CStop();
 142   1      }
 143          
 144          
 145          /**
 146           * @brief  前4位数码管显示
 147           * @note   每次点亮其中数字
 148           * @param  add: 
 149           * @param  dat: 
 150           * @retval None
 151           */
 152          void AiP650_Set_1(u8 add, u8 dat) //数码管显示
 153          {
 154   1        //写显存必须从高地址开始写
 155   1        I2CStart_1();
 156   1        I2CWrByte_1(add); //第一个显存地址
 157   1        I2Cask_1();
 158   1        I2CWrByte_1(dat);
 159   1        I2Cask_1();
 160   1        I2CStop_1();
 161   1      }
 162          
 163          
 164          /**
 165           * @brief  后4位数码管全显 显示一个四位数 （0-9999）带点
 166           * @note   
 167           * @param  Display_num: 
 168           * @retval None
 169           */
 170          void AiP650_DisPlayFour(u16 Display_num)
 171          {
 172   1        u8 Temp[4];
 173   1      
 174   1        Temp[0] = Display_num % 10000 / 1000;
C51 COMPILER V9.60.0.0   AIP650                                                            04/03/2021 12:04:58 PAGE 4   

 175   1        Temp[1] = Display_num % 1000 / 100;
 176   1        Temp[2] = Display_num % 100 / 10;
 177   1        Temp[3] = Display_num % 10;
 178   1      
 179   1        AiP650_Set(0x68, DISPLAY_CODE[Temp[0]]);
 180   1        AiP650_Set(0x6A, DISPLAY_CODE[Temp[1]]);
 181   1        AiP650_Set(0x6C, DISPLAY_CODE[Temp[2]]); //加点   AiP650_Set(0x6C,DISPLAY_CODE[Temp[2]]|0x80);
 182   1        AiP650_Set(0x6E, DISPLAY_CODE[Temp[3]]);
 183   1      }
 184          
 185          
 186          /**
 187           * @brief  前4位数码管全显 显示一个四位数 （0-9999）
 188           * @note   
 189           * @param  Display_num: 
 190           * @retval None
 191           */
 192          void AiP650_DisPlayFour_1(u16 Display_num)
 193          {
 194   1        u8 Temp[4];
 195   1        Temp[0] = Display_num % 10000 / 1000;
 196   1        Temp[1] = Display_num % 1000 / 100;
 197   1        Temp[2] = Display_num % 100 / 10;
 198   1        Temp[3] = Display_num % 10;
 199   1      
 200   1        AiP650_Set_1(0x68, DISPLAY_CODE[Temp[0]]);
 201   1        AiP650_Set_1(0x6A, DISPLAY_CODE[Temp[1]]);
 202   1        AiP650_Set_1(0x6C, DISPLAY_CODE[Temp[2]]); //加点   AiP650_Set(0x6C,DISPLAY_CODE[Temp[2]]|0x80);
 203   1      
 204   1        AiP650_Set_1(0x6E, DISPLAY_CODE[Temp[3]]); //SW1=0;}
 205   1      }
 206          
 207          /************************************************** 
 208            功能描述: //设置后4位数码管亮度等级 1-8级
 209            入口参数：
 210            说    明：                        
 211          **************************************************/
 212          void Light_Level_Set(u8 Level)
 213          {
 214   1        AiP650_Set(0x48, Light_Level_CODE[Level - 1]);
 215   1      }
 216          
 217          /************************************************** 
 218            功能描述: //设置前4位数码管亮度等级 1-8级
 219            入口参数：
 220            说    明：                        
 221          **************************************************/
 222          void Light_Level_Set_1(u8 Level)
 223          {
 224   1        AiP650_Set_1(0x48, Light_Level_CODE[Level - 1]);
 225   1      }
 226          
 227          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    602    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     32      18
   IDATA SIZE       =   ----    ----
C51 COMPILER V9.60.0.0   AIP650                                                            04/03/2021 12:04:58 PAGE 5   

   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
